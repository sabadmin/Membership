{% extends "base.html" %}

{% block title %}Database Fix Scripts - Admin Panel{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h2 class="mb-0">
                        <i class="fas fa-tools me-2"></i>Database Fix Scripts
                    </h2>
                    <small class="text-muted">Run database maintenance and fix scripts</small>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Warning:</strong> These scripts modify the database. Make sure you have backups before running them.
                        Only run scripts that you understand and need.
                    </div>

                    {% if fix_scripts %}
                        <style>
                            .scripts-grid {
                                display: grid;
                                grid-template-columns: repeat(3, 1fr);
                                gap: 20px;
                                margin-bottom: 20px;
                            }
                            @media (max-width: 992px) {
                                .scripts-grid {
                                    grid-template-columns: repeat(2, 1fr);
                                }
                            }
                            @media (max-width: 768px) {
                                .scripts-grid {
                                    grid-template-columns: 1fr;
                                }
                            }
                            .script-card {
                                border: 2px solid #007bff;
                                border-radius: 8px;
                                background: white;
                                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                            }
                            .script-header {
                                background: #f8f9fa;
                                padding: 12px 15px;
                                border-bottom: 1px solid #dee2e6;
                                border-radius: 6px 6px 0 0;
                            }
                            .script-body {
                                padding: 15px;
                                display: flex;
                                flex-direction: column;
                                min-height: 120px;
                            }
                            .script-description {
                                flex-grow: 1;
                                margin-bottom: 15px;
                                font-size: 14px;
                                color: #6c757d;
                            }
                            .script-button {
                                width: 100%;
                                padding: 8px;
                                background: #28a745;
                                color: white;
                                border: none;
                                border-radius: 4px;
                                cursor: pointer;
                                font-weight: bold;
                            }
                            .script-button:hover {
                                background: #218838;
                            }
                        </style>

                        <div class="scripts-grid">
                            {% for script in fix_scripts %}
                            <div class="script-card">
                                <div class="script-header">
                                    <strong>{{ script.replace('_', ' ').replace('.py', '').title() }}</strong>
                                </div>
                                <div class="script-body">
                                    <div class="script-description">
                                        <strong>Description:</strong><br>
                                        {% if 'database' in script.lower() %}
                                            üóÉÔ∏è Database schema and structure fixes
                                        {% elif 'migrate' in script.lower() %}
                                            üîÑ Data migration and transformation
                                        {% elif 'fix' in script.lower() %}
                                            üîß Bug fixes and corrections
                                        {% elif 'add' in script.lower() %}
                                            ‚ûï Add missing data or columns
                                        {% elif 'remove' in script.lower() %}
                                            ‚ûñ Remove obsolete data
                                        {% elif 'generate' in script.lower() %}
                                            ‚ú® Generate missing records
                                        {% elif 'reset' in script.lower() %}
                                            ‚Ü©Ô∏è Reset data to defaults
                                        {% elif 'purge' in script.lower() %}
                                            üóëÔ∏è Clean up old data
                                        {% elif 'seed' in script.lower() %}
                                            üå± Populate initial data
                                        {% elif 'setup' in script.lower() %}
                                            ‚öôÔ∏è System setup and configuration
                                        {% elif 'test' in script.lower() %}
                                            üß™ Testing and validation
                                        {% else %}
                                            üìÑ Maintenance script
                                        {% endif %}
                                    </div>
                                    <form method="post">
                                        <input type="hidden" name="script_name" value="{{ script }}">
                                        <button type="submit" class="script-button"
                                                onclick="return confirm('Run {{ script.replace('_', ' ').replace('.py', '').title() }}?\n\nThis will modify the database. Make sure you have backups!')">
                                            ‚ñ∂Ô∏è Start Script
                                        </button>
                                    </form>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            No fix scripts found in the project directory.
                        </div>
                    {% endif %}

                    <div class="mt-4">
                        <a href="{{ url_for('admin.admin_panel', selected_tenant_id=Config.SUPERADMIN_TENANT_ID) }}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left me-2"></i>Back to Admin Panel
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Auto-hide flash messages after 10 seconds
setTimeout(function() {
    const alerts = document.querySelectorAll('.alert');
    alerts.forEach(function(alert) {
        const bsAlert = new bootstrap.Alert(alert);
        bsAlert.close();
    });
}, 10000);
</script>
{% endblock %}
